# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

sources:
  my-bq-source:
    kind: bigquery
    project: servidio-test-a

tools:
  list_all_watchlist_symbols:
    kind: bigquery-sql
    source: my-bq-source
    statement: |
      SELECT
       record_id,
       symbol,
       exchange,
       added_on,
       target_price,
       notes
      FROM
        `analyst_demo`.`watchlist`
      WHERE
       user_id = @user_id
    description: |
      Use this tool to get a list of all items on the user watchlist.
    parameters:
      - name: user_id
        type: string
        description: Auto-populated from Google login
        authServices:
          # Refer to one of the `authServices` defined
          - name: my-google-auth
            # `sub` is the OIDC claim field for user ID
            field: sub
    authRequired:
      - my-google-auth
  search_watchlist_for_symbol:
    kind: bigquery-sql
    source: my-bq-source
    statement: |
      SELECT
       record_id,
       symbol,
       exchange,
       added_on,
       target_price,
       notes
      FROM
        `analyst_demo`.`watchlist`
      WHERE
       user_id = @user_id and UPPER(symbol) = UPPER(@symbol)
    description: |
      Use this tool to get information on Google Cloud Release Notes.
    parameters:
      - name: user_id
        type: string
        description: Auto-populated from Google login
        authServices:
          # Refer to one of the `authServices` defined
          - name: my-google-auth
            # `sub` is the OIDC claim field for user ID
            field: sub
      - name: symbol
        type: string
        description: The stock symbol
    authRequired:
      - my-google-auth
  add_symbol_to_watchlist:
    kind: bigquery-sql
    source: my-bq-source
    statement: |
      INSERT INTO `analyst_demo`.`watchlist` (record_id, user_id, symbol, exchange, added_on, target_price, notes)
      VALUES(GENERATE_UUID(), @user_id, UPPER(@symbol), UPPER(@exchange), CURRENT_TIMESTAMP(), CAST(@target_price AS NUMERIC), @notes)
    description: |
      Use this tool to get information on Google Cloud Release Notes.
    parameters:
      - name: user_id
        type: string
        description: Auto-populated from Google login
        authServices:
          # Refer to one of the `authServices` defined
          - name: my-google-auth
            # `sub` is the OIDC claim field for user ID
            field: sub
      - name: symbol
        type: string
        description: The stock symbol
        required: true
      - name: exchange
        type: string
        description: The exchange on which the stock is listed
        required: true
      - name: target_price
        type: float
        description: The target price
        required: false
        default: 0
      - name: notes
        type: string
        description: The user notes
        required: false
        default: N/A
    authRequired:
      - my-google-auth
  update_existing_symbol_on_watchlist:
    kind: bigquery-sql
    source: my-bq-source
    statement: |
      UPDATE `analyst_demo`.`watchlist`
      SET added_on = CURRENT_TIMESTAMP(), target_price = CAST(@target_price AS NUMERIC), notes = @notes
      WHERE user_id = @user_id AND UPPER(symbol) = UPPER(@symbol) AND UPPER(exchange) = UPPER(@exchange)
    description: |
      Use this tool to get information on Google Cloud Release Notes.
    parameters:
      - name: user_id
        type: string
        description: Auto-populated from Google login
        authServices:
          # Refer to one of the `authServices` defined
          - name: my-google-auth
            # `sub` is the OIDC claim field for user ID
            field: sub
      - name: symbol
        type: string
        description: The stock symbol
        required: true
      - name: exchange
        type: string
        description: The exchange on which the stock is listed
        required: true
      - name: target_price
        type: float
        description: The target price
        required: false
        default: 0
      - name: notes
        type: string
        description: The user notes
        required: false
        default: N/A
    authRequired:
      - my-google-auth
  remove_symbol_from_watchlist:
    kind: bigquery-sql
    source: my-bq-source
    statement: |
      DELETE FROM `analyst_demo`.`watchlist`
      WHERE user_id = @user_id AND UPPER(symbol) = UPPER(@symbol) and UPPER(exchange) = UPPER(@exchange)
    description: |
      Use this tool to get information on Google Cloud Release Notes.
    parameters:
      - name: user_id
        type: string
        description: Auto-populated from Google login
        authServices:
          # Refer to one of the `authServices` defined
          - name: my-google-auth
            # `sub` is the OIDC claim field for user ID
            field: sub
      - name: symbol
        type: string
        description: The stock symbol
        required: true
      - name: exchange
        type: string
        description: The exchange on which the stock is listed
        required: true
    authRequired:
      - my-google-auth

toolsets:
  my_bq_toolset:
    - list_all_watchlist_symbols
    - search_watchlist_for_symbol
    - add_symbol_to_watchlist
    - update_existing_symbol_on_watchlist
    - remove_symbol_from_watchlist

authServices:
  my-google-auth:
    kind: google
    clientId: 238251182086-etatg1ti13c1sg389f5n2lo65hj6n68b.apps.googleusercontent.com
